-- 1) Выбрать заказ с id 1
SELECT 
    o.order_id,
    o.order_date,
    c.full_name as клиент,
    car.brand || ' ' || car.model as автомобиль
FROM "Order" o
JOIN Client c ON o.client_id = c.client_id
JOIN Car car ON o.car_id = car.car_id
WHERE o.order_id = 1;

-- 2) Самые продаваемые материалы топ 5
SELECT 
    m.material_name,
    COUNT(mu.usage_id) as раз_использован
FROM Material m
LEFT JOIN Material_Usage mu ON m.material_id = mu.material_id
GROUP BY m.material_id, m.material_name
ORDER BY раз_использован DESC
LIMIT 5;

-- 3) Выручка со всех заказов за период
SELECT 
    EXTRACT(YEAR FROM order_date) as год,
    EXTRACT(MONTH FROM order_date) as месяц,
    SUM(total_amount) as выручка
FROM "Order"
WHERE order_date BETWEEN '2025-01-01' AND '2025-12-31'
  AND status = 'completed'
GROUP BY EXTRACT(YEAR FROM order_date), EXTRACT(MONTH FROM order_date)
ORDER BY год, месяц;
